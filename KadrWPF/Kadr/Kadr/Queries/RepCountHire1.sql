SELECT 
	code_SUBDIV,
	case when alll=0 then null else alll end,
	case when main_emp=0 then null else main_emp end,
	case when help_emp=0 then null else help_emp end,
	case when pupil=0 then null else pupil end,
	case when boss=0 then null else boss end,
	case when spec=0 then null else spec end,
	case when other=0 then null else other end,
	case when temp_emp=0 then null else temp_emp end,
	case when comb_emp=0 then null else comb_emp end,
	case when h_sch=0 then null else h_sch end,
	case when mid_tech=0 then null else mid_tech end,
	case when mid_spec=0 then null else mid_spec end,
	case when middl=0 then null else middl end,
	case when nf_mid=0 then null else nf_mid end,
	case when bef_18=0 then null else bef_18 end,
	case when p18_30=0 then null else p18_30 end,
	case when p31_40=0 then null else p31_40 end,
	case when p41_50=0 then null else p41_50 end,
	case when p51_55=0 then null else p51_55 end,
	case when af_55=0 then null else af_55 end,
	case when ret=0 then null else ret end,
	case when town=0 then null else town end,
	case when vill=0 then null else vill end,
	case when dist=0 then null else dist end,
	case when ra=0 then null else ra end
	FROM 
(
select 
'Цеха' as code_SUBDIV,
null as alll,
null as main_emp,
null as help_emp,
null as pupil,
null as boss,
null as spec,
null as other,
null as temp_emp,
null as comb_emp,
null as h_sch,
null as mid_tech,
null as mid_spec,
null as middl,
null as nf_mid,
null as bef_18,
null as p18_30,
null as p31_40,
null as p41_50,
null as p51_55,
null as af_55,
null as ret,
null as town,
null as vill,
null as dist,
null as ra from dual
union all
select *
from
(select s1.code_subdiv, 
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and contr_emp is not null and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as alll,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (01,08) /*and char_work_id not in (2,3)*/ and contr_emp is not null and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as main_emp,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (05,09,07,02) /*and char_work_id not in (2,3)*/ and contr_emp is not null and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as help_emp,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id=06 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and contr_emp is not null and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as pupil,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=2 and contr_emp is not null /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as boss,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=3 and contr_emp is not null /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as spec,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1) not in (1,2,3) and contr_emp is not null /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as other,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and char_work_id in (2,3) and sign_comb<>1 and type_transfer_id=1 and contr_emp is not null and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as temp_emp, 
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and sign_comb=1 and type_transfer_id=1 and contr_emp is not null and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as comb_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and tr.contr_emp is not null /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as h_sch,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and tr.contr_emp is not null /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_tech,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and tr.contr_emp is not null /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_spec,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and tr.contr_emp is not null/*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as middl,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num and tr.contr_emp is not null/*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as nf_mid,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and contr_emp is not null and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as bef_18,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and contr_emp is not null and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p18_30,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and contr_emp is not null and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p31_40,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and contr_emp is not null and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p41_50,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 55 and contr_emp is not null and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p51_55,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>55 and contr_emp is not null and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as af_55,
(select count(contr_emp) from {2}.transfer tr,{2}.per_data pd where tr.subdiv_id=s1.subdiv_id and tr.per_num=pd.per_num and retirer_sign=1 /*and char_work_id not in (2,3)*/ and contr_emp is not null and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ret,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id = 2 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and contr_emp is not null and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as town,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id=1 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and contr_emp is not null and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as vill,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id=3 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and contr_emp is not null and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as dist,
(select count(contr_emp) from {2}.transfer tr where source_id=02 and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and contr_emp is not null and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ra 
from {2}.subdiv s1 where type_subdiv_id in (2,3) and sub_actual_sign=1 order by code_subdiv  ) /*where alll!=0*/
union all
select '500' as code_subdiv,
sum(alll),
sum(main_emp),
sum(help_emp),
sum(pupil),
sum(boss),
sum(spec),
sum(other),
sum(temp_emp),
sum(comb_emp),
sum(h_sch),
sum(mid_tech),
sum(mid_spec),
sum(middl),
sum(nf_mid),
sum(bef_18),
sum(p18_30),
sum(p31_40),
sum(p41_50),
sum(p51_55),
sum(af_55),
sum(ret),
sum(town),
sum(vill),
sum(dist),
sum(ra)
from
(select null as code_subdiv, 
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as alll,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and degree_id in (01,08) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as main_emp,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and degree_id in (05,09,07,02) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as help_emp,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and degree_id=06 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as pupil,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=2 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as boss,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=3 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as spec,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1) not in (1,2,3) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as other,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and char_work_id in (2,3) and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as temp_emp, 
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and sign_comb=1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as comb_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as h_sch,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_tech,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_spec,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as middl,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as nf_mid,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as bef_18,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p18_30,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p31_40,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p41_50,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p51_55,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as af_55,
(select count(contr_emp) from {2}.transfer tr,{2}.per_data pd where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and tr.per_num=pd.per_num and retirer_sign=1 /*and char_work_id not in (2,3)*/ and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ret,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id = 2 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as town,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id=1 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as vill,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id=3 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as dist,
(select count(contr_emp) from {2}.transfer tr where source_id=02 and tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ra 
from {2}.subdiv s1 where s1.code_subdiv like '5__' and sub_actual_sign=1 order by code_subdiv)
union all
select *
from
(select distinct 'Итого' as code_subdiv,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as alll,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and degree_id in (01,08) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as main_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and degree_id in (05,09,07,02) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as help_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and degree_id=06 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as pupil,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=2 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as boss,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=3 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as spec,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1) not in (1,2,3) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as other,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and char_work_id in (2,3) and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as temp_emp, 
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and sign_comb=1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as comb_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as h_sch,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_tech,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_spec,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as middl,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as nf_mid,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as bef_18,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p18_30,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p31_40,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p41_50,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p51_55,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as af_55,
(select count(contr_emp) from {2}.transfer tr,{2}.per_data pd, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and tr.per_num=pd.per_num and retirer_sign=1 /*and char_work_id not in (2,3)*/ and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ret,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and reg.source_fill_id = 2 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as town,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and reg.source_fill_id=1 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as vill,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and reg.source_fill_id=3 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as dist,
(select count(contr_emp) from {2}.transfer tr , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and source_id=02 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ra 
from {2}.subdiv s1 where (type_subdiv_id in (2,3) or code_subdiv like '5__') and sub_actual_sign=1 ) /*where alll!=0*/
union all
select 
'Отделы' as code_SUBDIV,
null as alll,
null as main_emp,
null as help_emp,
null as pupil,
null as boss,
null as spec,
null as other,
null as temp_emp,
null as comb_emp,
null as h_sch,
null as mid_tech,
null as mid_spec,
null as middl,
null as nf_mid,
null as bef_18,
null as p18_30,
null as p31_40,
null as p41_50,
null as p51_55,
null as af_55,
null as ret,
null as town,
null as vill,
null as dist,
null as ra from dual
union all
select *
from
(select (case (s1.code_subdiv)
	when '081' then '1'
	when '083' then '3'
	when '085' then '5'
	when '086' then '6'
	when '087' then '7'
	when '089' then '9'
	when '090' then '10'
	when '092' then '12'
	when '093' then '23'
	when '096' then '16'
	when '097' then '17'
	else s1.code_subdiv
	end) as code_subdiv,  
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as alll,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (01,08) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as main_emp,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (05,09,07,02) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as help_emp,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id=06 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as pupil,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=2 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as boss,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=3 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as spec,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1) not in (1,2,3) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as other,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and char_work_id in (2,3) and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as temp_emp, 
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and sign_comb=1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as comb_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as h_sch,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_tech,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_spec,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as middl,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as nf_mid,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as bef_18,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p18_30,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p31_40,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p41_50,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p51_55,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as af_55,
(select count(contr_emp) from {2}.transfer tr,{2}.per_data pd where tr.subdiv_id=s1.subdiv_id and tr.per_num=pd.per_num and retirer_sign=1 /*and char_work_id not in (2,3)*/ and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ret,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id = 2 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as town,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id=1 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as vill,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id=3 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as dist,
(select count(contr_emp) from {2}.transfer tr where source_id=02 and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ra 
from {2}.subdiv s1 where type_subdiv_id = 1 and sub_actual_sign=1 order by to_number(regexp_substr(code_subdiv,'\d*'))) /*where alll!=0*/
union all
select *
from
(select distinct 'Итого' as code_subdiv,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as alll,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and degree_id in (01,08) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as main_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and degree_id in (05,09,07,02) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as help_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and degree_id=06 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as pupil,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=2 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as boss,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=3 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as spec,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1) not in (1,2,3) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as other,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and char_work_id in (2,3) and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as temp_emp, 
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and sign_comb=1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as comb_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as h_sch,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_tech,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_spec,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as middl,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as nf_mid,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as bef_18,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p18_30,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p31_40,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p41_50,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p51_55,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as af_55,
(select count(contr_emp) from {2}.transfer tr,{2}.per_data pd, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and tr.per_num=pd.per_num and retirer_sign=1 /*and char_work_id not in (2,3)*/ and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ret,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and reg.source_fill_id = 2 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as town,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and reg.source_fill_id=1 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as vill,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and reg.source_fill_id=3 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as dist,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and source_id=02 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ra 
from {2}.subdiv s1 where type_subdiv_id = 1 and sub_actual_sign=1 ) /*where alll!=0*/

union all
select *
from
(select distinct 'Всего' as code_subdiv,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as alll,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and degree_id in (01,08) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as main_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and degree_id in (05,09,07,02) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as help_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and degree_id=06 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as pupil,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=2 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as boss,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=3 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as spec,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1) not in (1,2,3) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as other,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and char_work_id in (2,3) and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as temp_emp, 
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and sign_comb=1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as comb_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as h_sch,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_tech,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_spec,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as middl,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as nf_mid,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as bef_18,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p18_30,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p31_40,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p41_50,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p51_55,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as af_55,
(select count(contr_emp) from {2}.transfer tr,{2}.per_data pd, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and tr.per_num=pd.per_num and retirer_sign=1 /*and char_work_id not in (2,3)*/ and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ret,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and reg.source_fill_id = 2 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as town,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and reg.source_fill_id=1 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as vill,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and reg.source_fill_id=3 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as dist,
(select count(contr_emp) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and source_id=02 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ra 
from {2}.subdiv s1 where (type_subdiv_id in (1,2,3) or code_subdiv like '5__') and sub_actual_sign=1 ) /*where alll!=0*/


union all
select 
'Непром. группа' as code_SUBDIV,
null as alll,
null as main_emp,
null as help_emp,
null as pupil,
null as boss,
null as spec,
null as other,
null as temp_emp,
null as comb_emp,
null as h_sch,
null as mid_tech,
null as mid_spec,
null as middl,
null as nf_mid,
null as bef_18,
null as p18_30,
null as p31_40,
null as p41_50,
null as p51_55,
null as af_55,
null as ret,
null as town,
null as vill,
null as dist,
null as ra from dual
union all
select *
from
(select s1.code_subdiv, 
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as alll,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (01,08) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as main_emp,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (05,09,07,02) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as help_emp,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id=06 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as pupil,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=2 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as boss,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=3 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as spec,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1) not in (1,2,3) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as other,
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and char_work_id in (2,3) and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as temp_emp, 
(select count(contr_emp) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and sign_comb=1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as comb_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as h_sch,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_tech,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_spec,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as middl,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as nf_mid,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as bef_18,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p18_30,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p31_40,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p41_50,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p51_55,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as af_55,
(select count(contr_emp) from {2}.transfer tr,{2}.per_data pd where tr.subdiv_id=s1.subdiv_id and tr.per_num=pd.per_num and retirer_sign=1 /*and char_work_id not in (2,3)*/ and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ret,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id = 2 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as town,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id=1 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as vill,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id=3 and tr.per_num = reg.per_num and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as dist,
(select count(contr_emp) from {2}.transfer tr where source_id=02 and tr.subdiv_id=s1.subdiv_id /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ra 
from {2}.subdiv s1 where type_subdiv_id = 4 and sub_actual_sign=1 order by code_subdiv) /*where alll!=0*/
union all
select *
from
(select distinct 'Итого' as code_subdiv,
(select count(contr_emp) from {2}.transfer tr , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as alll,
(select count(contr_emp) from {2}.transfer tr , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and degree_id in (01,08) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as main_emp,
(select count(contr_emp) from {2}.transfer tr , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and degree_id in (05,09,07,02) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as help_emp,
(select count(contr_emp) from {2}.transfer tr , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and degree_id=06 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as pupil,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos , {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=2 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as boss,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos , {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=3 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as spec,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos , {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1) not in (1,2,3) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as other,
(select count(contr_emp) from {2}.transfer tr , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and char_work_id in (2,3) and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as temp_emp, 
(select count(contr_emp) from {2}.transfer tr , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and sign_comb=1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as comb_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as h_sch,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_tech,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_spec,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as middl,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as nf_mid,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em , {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as bef_18,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em , {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p18_30,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em , {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p31_40,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em , {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p41_50,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em , {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p51_55,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em , {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as af_55,
(select count(contr_emp) from {2}.transfer tr,{2}.per_data pd , {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and tr.per_num=pd.per_num and retirer_sign=1 /*and char_work_id not in (2,3)*/ and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ret,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and reg.source_fill_id = 2 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as town,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and reg.source_fill_id=1 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as vill,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and reg.source_fill_id=3 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as dist,
(select count(contr_emp) from {2}.transfer tr , {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and source_id=02 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ra 
from {2}.subdiv s1 where type_subdiv_id = 4 and sub_actual_sign=1 ) /*where alll!=0*/
union all
select *
from
(select distinct 'Итого по заводу' as code_subdiv, 
(select count(contr_emp) from {2}.transfer tr where /*char_work_id not in (2,3) and */sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as alll,
(select count(contr_emp) from {2}.transfer tr where degree_id in (01,08) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as main_emp,
(select count(contr_emp) from {2}.transfer tr where degree_id in (05,09,07,02) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as help_emp,
(select count(contr_emp) from {2}.transfer tr where degree_id=06 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as pupil,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=2 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as boss,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1)=3 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as spec,
(select count(contr_emp) from {2}.transfer tr, {2}.position pos where pos.pos_id=tr.pos_id and substr(pos.code_pos,1,1) not in (1,2,3) /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as other,
(select count(contr_emp) from {2}.transfer tr where char_work_id in (2,3) and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as temp_emp, 
(select count(contr_emp) from {2}.transfer tr where sign_comb=1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as comb_emp,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as h_sch,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_tech,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as mid_spec,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as middl,
(select count(contr_emp) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as nf_mid,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as bef_18,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p18_30,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p31_40,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p41_50,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as p51_55,
(select count(contr_emp) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>55 and tr.per_num=em.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as af_55,
(select count(contr_emp) from {2}.transfer tr,{2}.per_data pd where tr.per_num=pd.per_num and retirer_sign=1 /*and char_work_id not in (2,3)*/ and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ret,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id = 2 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as town,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id=1 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as vill,
(select count(contr_emp) from {2}.transfer tr, {2}.registr reg where reg.source_fill_id=3 and tr.per_num = reg.per_num /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as dist,
(select count(contr_emp) from {2}.transfer tr where source_id=02 /*and char_work_id not in (2,3)*/ and sign_comb<>1 and type_transfer_id=1 and trunc(date_transfer) between to_date('{0}','DD.MM.YYYY') and to_date('{1}','DD.MM.YYYY')) as ra 
from {2}.subdiv s1 where sub_actual_sign=1) /*where alll!=0*/
) ResTbl