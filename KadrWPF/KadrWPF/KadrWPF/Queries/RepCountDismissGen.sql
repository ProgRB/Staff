SELECT 
	code_SUBDIV,
	case when alll=0 then null else alll end,
	case when main_emp=0 then null else main_emp end,
	case when help_emp=0 then null else help_emp end,
	case when pupil=0 then null else pupil end,
	case when boss=0 then null else boss end,
	case when spec=0 then null else spec end,
	case when other=0 then null else other end,
	case when our_drm=0 then null else our_drm end,
	case when trncy=0 then null else trncy end,
	case when rdc=0 then null else rdc end,
	case when stlg=0 then null else stlg end,
	case when drnk=0 then null else drnk end,
	case when not_job=0 then null else not_job end,
	case when judg=0 then null else judg end,
	case when nf_mid=0 then null else nf_mid end,
	case when middl=0 then null else middl end,
	case when mid_tech=0 then null else mid_tech end,
	case when h_sch=0 then null else h_sch end,
	case when mid_spec=0 then null else mid_spec end,
	case when bef_18=0 then null else bef_18 end,
	case when p18_30=0 then null else p18_30 end,
	case when p31_40=0 then null else p31_40 end,
	case when p41_50=0 then null else p41_50 end,
	case when p51_60=0 then null else p51_60 end,
	case when af_60=0 then null else af_60 end
FROM 
(
select 
'Цеха' as code_SUBDIV,
null as alll,
null as main_emp,
null as help_emp,
null as pupil,
null as boss,
null as spec,
null as other,
null as our_drm,
null as trncy,
null as rdc,
null as stlg,
null as drnk,
null as not_job,
null as judg,
null as nf_mid,
null as middl,
null as mid_tech,
null as h_sch,
null as mid_spec,
null as bef_18,
null as p18_30,
null as p31_40,
null as p41_50,
null as p51_60,
null as af_60 from dual
union all
select * from
(select s1.code_subdiv, 
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1 ) as alll,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (01,08) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as main_emp,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (05,09,07,02) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as help_emp,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id=06 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as pupil,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=2) or (substr(pos.code_pos,1,1)=2)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as boss,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=3) or (substr(pos.code_pos,1,1)=3)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id) not in (1,2,3) ) or (substr(pos.code_pos,1,1) not in (1,2,3))) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as other,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id in (08,10,13,14,15,23,24,25,26,27,45,46) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as our_drm,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =19 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as trncy,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id in (03,87,107) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as rdc,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =36 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as stlg,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =20 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as drnk,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =41 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as not_job,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =21 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as judg,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as nf_mid,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as middl,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_tech,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as h_sch,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as bef_18,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p18_30,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p31_40,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p41_50,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p51_60,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as af_60
from {2}.subdiv s1 where type_subdiv_id in (2,3) and sub_actual_sign=1 order by code_subdiv) /*where alll!=0*/
union all
select '500' as code_subdiv,
sum( alll),
sum( main_emp),
sum( help_emp),
sum( pupil),
sum( boss),
sum( spec),
sum( other),
sum( our_drm),
sum( trncy),
sum( rdc),
sum( stlg),
sum( drnk),
sum( not_job),
sum( judg),
sum( nf_mid),
sum( middl),
sum( mid_tech),
sum( h_sch),
sum( mid_spec),
sum( bef_18),
sum( p18_30),
sum( p31_40),
sum( p41_50),
sum( p51_60),
sum( af_60)
from
(select null as code_subdiv, 
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as alll,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and degree_id in (01,08) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as main_emp,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and degree_id in (05,09,07,02) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as help_emp,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and degree_id=06 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as pupil,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=2) or (substr(pos.code_pos,1,1)=2)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as boss,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=3) or (substr(pos.code_pos,1,1)=3)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id) not in (1,2,3) ) or (substr(pos.code_pos,1,1) not in (1,2,3))) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as other,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and reason_id in (08,10,13,14,15,23,24,25,26,27,45,46) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as our_drm, 
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and reason_id =19 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as trncy,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and reason_id in (03,87,107) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as rdc,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and reason_id =36 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as stlg,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and reason_id =20 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as drnk,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and reason_id =41 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as not_job,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and reason_id =21 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as judg,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as nf_mid,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as middl,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_tech,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as h_sch,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as bef_18,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p18_30,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p31_40,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p41_50,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p51_60,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and s1.code_subdiv like '5__' and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as af_60
from {2}.subdiv s1 where s1.code_subdiv like '5__' and sub_actual_sign=1 order by code_subdiv) group by code_subdiv /*where alll!=0*/



union all
select * from
(select distinct 'Итого' as code_subdiv, 
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and /*(trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and*/ sign_comb!=1 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy')) as alll,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and degree_id in (01,08) and type_transfer_id=3 and /*(trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and*/ sign_comb!=1 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy')) as main_emp,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and degree_id in (05,09,07,02) and type_transfer_id=3 and /*(trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and*/ sign_comb!=1 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy')) as help_emp,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and degree_id=06 and type_transfer_id=3 and /*(trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and*/ sign_comb!=1 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy')) as pupil,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=2) or (substr(pos.code_pos,1,1)=2)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as boss,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=3) or (substr(pos.code_pos,1,1)=3)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id) not in (1,2,3) ) or (substr(pos.code_pos,1,1) not in (1,2,3))) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as other,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id in (08,10,13,14,15,23,24,25,26,27,45,46) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as our_drm, 
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id =19 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as trncy,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id in (03,87,107) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as rdc,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id =36 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as stlg,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id =20 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as drnk,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id =41 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as not_job,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id =21 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as judg,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as nf_mid,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as middl,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_tech,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as h_sch,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as bef_18,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p18_30,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p31_40,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p41_50,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p51_60,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as af_60
from {2}.subdiv s1 where (type_subdiv_id in (2,3) or code_subdiv like '5__')  and sub_actual_sign=1) /*where alll!=0*/
union all
select 
'Отделы' as code_SUBDIV,
null as alll,
null as main_emp,
null as help_emp,
null as pupil,
null as boss,
null as spec,
null as other,
null as our_drm,
null as trncy,
null as rdc,
null as stlg,
null as drnk,
null as not_job,
null as judg,
null as nf_mid,
null as middl,
null as mid_tech,
null as h_sch,
null as mid_spec,
null as bef_18,
null as p18_30,
null as p31_40,
null as p41_50,
null as p51_60,
null as af_60 from dual
union all
select * from
(select (case (s1.code_subdiv)
	when '081' then '1'
	when '083' then '3'
	when '085' then '5'
	when '086' then '6'
	when '087' then '7'
	when '089' then '9'
	when '090' then '10'
	when '092' then '12'
	when '093' then '23'
	when '096' then '16'
	when '097' then '17'
	else s1.code_subdiv
	end) as code_subdiv, 
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as alll,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (01,08) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as main_emp,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (05,09,07,02) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as help_emp,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id=06 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as pupil,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=2) or (substr(pos.code_pos,1,1)=2)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as boss,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=3) or (substr(pos.code_pos,1,1)=3)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id) not in (1,2,3) ) or (substr(pos.code_pos,1,1) not in (1,2,3))) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as other,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id in (08,10,13,14,15,23,24,25,26,27,45,46) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as our_drm, 
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =19 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as trncy,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id in (03,87,107) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as rdc,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =36 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as stlg,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =20 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as drnk,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =41 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as not_job,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =21 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as judg,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as nf_mid,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as middl,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_tech,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as h_sch,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as bef_18,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p18_30,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p31_40,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p41_50,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p51_60,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as af_60
from {2}.subdiv s1 where type_subdiv_id = 1 and sub_actual_sign=1 order by to_number(regexp_substr(code_subdiv,'\d*'))) /*where alll!=0*/
union all
select * from
(select distinct 'Итого' as code_subdiv, 
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as alll,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and degree_id in (01,08) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as main_emp,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and degree_id in (05,09,07,02) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as help_emp,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and degree_id=06 and type_transfer_id=3 and (trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and sign_comb!=1 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy')) as pupil,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=2) or (substr(pos.code_pos,1,1)=2)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as boss,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=3) or (substr(pos.code_pos,1,1)=3)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id) not in (1,2,3) ) or (substr(pos.code_pos,1,1) not in (1,2,3))) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as other,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and type_transfer_id=3 and reason_id in (08,10,13,14,15,23,24,25,26,27,45,46) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as our_drm, 
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and type_transfer_id=3 and reason_id =19 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as trncy,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and type_transfer_id=3 and reason_id in (03,87,107) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as rdc,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and type_transfer_id=3 and reason_id =36 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as stlg,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and type_transfer_id=3 and reason_id =20 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as drnk,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and type_transfer_id=3 and reason_id =41 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as not_job,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and type_transfer_id=3 and reason_id =21 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as judg,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as nf_mid,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as middl,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_tech,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as h_sch,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as bef_18,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p18_30,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p31_40,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p41_50,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p51_60,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 1 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as af_60
from {2}.subdiv s1 where type_subdiv_id = 1 and sub_actual_sign=1) /*where alll!=0*/
union all
select * from
(select distinct 'Всего' as code_subdiv, 
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as alll,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and degree_id in (01,08) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as main_emp,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and degree_id in (05,09,07,02) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as help_emp,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and degree_id=06 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as pupil,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=2) or (substr(pos.code_pos,1,1)=2)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as boss,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=3) or (substr(pos.code_pos,1,1)=3)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id) not in (1,2,3) ) or (substr(pos.code_pos,1,1) not in (1,2,3))) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as other,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id in (08,10,13,14,15,23,24,25,26,27,45,46) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as our_drm, 
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id =19 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as trncy,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id in (03,87,107) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as rdc,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id =36 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as stlg,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id =20 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as drnk,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id =41 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as not_job,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and type_transfer_id=3 and reason_id =21 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as judg,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as nf_mid,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as middl,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_tech,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as h_sch,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as bef_18,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p18_30,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p31_40,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p41_50,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p51_60,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and (sub.type_subdiv_id in (1,2,3) or sub.code_subdiv like '5__') and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as af_60
from {2}.subdiv s1 where (type_subdiv_id in (1,2,3) or code_subdiv like '5__') and sub_actual_sign=1) /*where alll!=0*/
union all
select 
'Непром.группа' as code_SUBDIV,
null as alll,
null as main_emp,
null as help_emp,
null as pupil,
null as boss,
null as spec,
null as other,
null as our_drm,
null as trncy,
null as rdc,
null as stlg,
null as drnk,
null as not_job,
null as judg,
null as nf_mid,
null as middl,
null as mid_tech,
null as h_sch,
null as mid_spec,
null as bef_18,
null as p18_30,
null as p31_40,
null as p41_50,
null as p51_60,
null as af_60 from dual
union all
select * from
(select s1.code_subdiv, 
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as alll,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (01,08) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as main_emp,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id in (05,09,07,02,13) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as help_emp,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and degree_id=06 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as pupil,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=2) or (substr(pos.code_pos,1,1)=2)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as boss,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=3) or (substr(pos.code_pos,1,1)=3)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where tr.subdiv_id=s1.subdiv_id and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id) not in (1,2,3) ) or (substr(pos.code_pos,1,1) not in (1,2,3))) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as other,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id in (08,10,13,14,15,23,24,25,26,27,45,46) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as our_drm, 
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =19 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as trncy,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id in (03,87,107) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as rdc,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =36 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as stlg,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =20 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as drnk,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =41 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as not_job,
(select count(tr_num_order) from {2}.transfer tr where tr.subdiv_id=s1.subdiv_id and type_transfer_id=3 and reason_id =21 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as judg,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as nf_mid,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as middl,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_tech,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as h_sch,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where tr.subdiv_id=s1.subdiv_id and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as bef_18,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p18_30,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p31_40,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p41_50,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p51_60,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where tr.subdiv_id=s1.subdiv_id and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as af_60
from {2}.subdiv s1 where type_subdiv_id = 4 and sub_actual_sign=1 order by code_subdiv) /*where alll!=0*/
union all
select * from
(select distinct 'Итого' as code_subdiv, 
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as alll,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and degree_id in (01,08) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as main_emp,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and degree_id in (05,09,07,02,13) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as help_emp,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and degree_id=06 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as pupil,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=2) or (substr(pos.code_pos,1,1)=2)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as boss,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=3) or (substr(pos.code_pos,1,1)=3)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id) not in (1,2,3) ) or (substr(pos.code_pos,1,1) not in (1,2,3))) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as other,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and type_transfer_id=3 and reason_id in (08,10,13,14,15,23,24,25,26,27,45,46) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as our_drm, 
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and type_transfer_id=3 and reason_id =19 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as trncy,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and type_transfer_id=3 and reason_id in (03,87,107) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as rdc,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and type_transfer_id=3 and reason_id =36 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as stlg,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and type_transfer_id=3 and reason_id =20 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as drnk,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and type_transfer_id=3 and reason_id =41 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as not_job,
(select count(tr_num_order) from {2}.transfer tr, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and type_transfer_id=3 and reason_id =21 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as judg,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as nf_mid,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as middl,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_tech,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as h_sch,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed, {2}.subdiv sub where tr.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as bef_18,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p18_30,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p31_40,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p41_50,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p51_60,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em, {2}.subdiv sub where TR.SUBDIV_ID = SUB.SUBDIV_ID and sub.type_subdiv_id = 4 and (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as af_60
from {2}.subdiv s1 where type_subdiv_id = 4 and sub_actual_sign=1) /*where alll!=0*/
union all
select * from
(select distinct 'Всего по заводу' as code_subdiv, 
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as alll,
(select count(tr_num_order) from {2}.transfer tr where degree_id in (01,08) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as main_emp,
(select count(tr_num_order) from {2}.transfer tr where degree_id in (05,09,07,02,13) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as help_emp,
(select count(tr_num_order) from {2}.transfer tr where degree_id=06 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as pupil,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=2) or (substr(pos.code_pos,1,1)=2)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as boss,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=3) or (substr(pos.code_pos,1,1)=3)) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id) not in (1,2,3) ) or (substr(pos.code_pos,1,1) not in (1,2,3))) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as other,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id in (08,10,13,14,15,23,24,25,26,27,45,46) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as our_drm, 
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id =19 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as trncy,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id in (03,87,107) and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as rdc,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id =36 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as stlg,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id =20 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as drnk,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id =41 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as not_job,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id =21 and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as judg,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num=tr.per_num and type_edu_id!=8) in (0,1,2) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as nf_mid,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as middl,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_tech,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as h_sch,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as mid_spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as bef_18,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p18_30,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p31_40,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p41_50,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as p51_60,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>60 and tr.per_num=em.per_num and type_transfer_id=3 and trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb!=1) as af_60
from {2}.subdiv s1 where sub_actual_sign=1) /*where alll!=0*/
union all
select * from
(select distinct 'В том числе совместители' as code_subdiv, 
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and /*trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') or (trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy') and */trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb=1) as alll,
(select count(tr_num_order) from {2}.transfer tr where degree_id in (01,08) and type_transfer_id=3 and /*trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and */trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as main_emp,
(select count(tr_num_order) from {2}.transfer tr where degree_id in (05,09,07,02) and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and */trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as help_emp,
(select count(tr_num_order) from {2}.transfer tr where degree_id=06 and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and */trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as pupil,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=2) or (substr(pos.code_pos,1,1)=2)) and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as boss,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id)=3) or (substr(pos.code_pos,1,1)=3)) and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.position pos where pos.pos_id=tr.pos_id and ((substr(pos.code_pos,1,1)=9 and (select substr(pos1.code_pos,1,1) from {2}.position pos1 where pos1.pos_id = pos.from_pos_id) not in (1,2,3) ) or (substr(pos.code_pos,1,1) not in (1,2,3))) and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as other,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id in (2,08,10,13,14,15,23,24,25,26,27,45,46) and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as our_drm, 
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id =19 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as trncy,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id in (03,87,107) and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as rdc,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id =36 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as stlg,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id =20 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as drnk,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id =41 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as not_job,
(select count(tr_num_order) from {2}.transfer tr where type_transfer_id=3 and reason_id =21 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as judg,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (0,1,2) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (0,1,2) and tr.per_num=ed.per_num and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as nf_mid,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (3,9,12) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (3,9,12) and tr.per_num=ed.per_num and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as middl,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (4,11) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (4,11) and tr.per_num=ed.per_num and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as mid_tech,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (6,7) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (6,7) and tr.per_num=ed.per_num and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as h_sch,
(select count(tr_num_order) from {2}.transfer tr, {2}.edu ed where ed.type_edu_id in (5,10) and ed.edu_id = (select max(edu_id) from {2}.edu ed where per_num = tr.per_num and type_edu_id = (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8)) and (select max(type_edu_id) from {2}.edu ed where ed.per_num = tr.per_num and type_edu_id !=8) in (5,10) and tr.per_num=ed.per_num and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy')) and*/ trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as mid_spec,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))<18 and tr.per_num=em.per_num and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and */trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as bef_18,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 18 and 30 and tr.per_num=em.per_num and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and */trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as p18_30,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 31 and 40 and tr.per_num=em.per_num and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and */trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as p31_40,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 41 and 50 and tr.per_num=em.per_num and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and */trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as p41_50,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12)) between 51 and 60 and tr.per_num=em.per_num and type_transfer_id=3 and/* trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') /*or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and */trunc(df_book_dismiss) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as p51_60,
(select count(tr_num_order) from {2}.transfer tr, {2}.emp em where (trunc(MONTHS_BETWEEN(tr.date_transfer, em.emp_birth_date)/12))>60 and tr.per_num=em.per_num and type_transfer_id=3 and /*trunc(date_transfer) between to_date('{0}', 'dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') or trunc(date_transfer) < to_date('{0}', 'dd.mm.yyyy'))  and */trunc(df_book_dismiss) between to_date('{0}','dd.mm.yyyy') and to_date('{1}', 'dd.mm.yyyy') and sign_comb = 1) as af_60
from {2}.subdiv s1 where sub_actual_sign=1)
) ResTbl